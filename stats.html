<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gotham FC Team Stats</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Saira+Semi+Condensed:wght@600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="assets/css/custom-styles.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gotham: { black: '#000000', dark: '#0a0a0a', cyan: '#22d3ee' }
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-black text-gray-200 antialiased selection:bg-cyan-400 selection:text-black">

    <!-- Navbar -->
    <nav class="fixed w-full z-50 glass-nav transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <a href="./index.html" class="flex-shrink-0 flex items-center gap-3 group cursor-pointer">
                    <svg class="h-10 w-10 text-white group-hover:text-gotham-cyan transition-colors"
                        viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M50 0L95.11 25V75L50 100L4.89 75V25L50 0Z" fill="currentColor" />
                        <path d="M50 10L86.6 30V70L50 90L13.4 70V30L50 10Z" fill="#000000" />
                        <text x="50" y="62" font-family="Saira Semi Condensed, sans-serif" font-size="30"
                            font-weight="800" fill="currentColor" text-anchor="middle">GFC</text>
                    </svg>
                    <span
                        class="font-heading font-bold text-2xl tracking-wide text-white group-hover:text-gotham-cyan transition-colors">FAN
                        HUB</span>
                </a>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-8">
                        <a href="./index.html" class="nav-link text-sm tracking-widest uppercase">Home</a>
                        <a href="./roster.html" class="nav-link text-sm tracking-widest uppercase">Roster</a>
                        <a href="#" class="nav-link active text-sm tracking-widest uppercase">Stats</a>
                        <a href="https://www.gothamfc.com/tickets" target="_blank" class="btn-primary text-xs ml-4">Get
                            Tickets</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Header -->
    <header class="pt-32 pb-8 px-4 text-center">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-4xl md:text-6xl font-black text-white mb-2 uppercase">Season Analytics</h1>
            <p class="text-gray-400 text-lg font-light">Breaking down the 2025 Championship Campaign</p>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 pb-20 space-y-8" id="stats-page-container">

        <!-- Standings Banner -->
        <div id="standings-container" class="card-modern p-8 relative overflow-hidden">
            <div class="absolute inset-0 bg-gotham-cyan/5"></div>
            <p class="text-center text-gray-400">Loading standings...</p>
        </div>

        <!-- Charts Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="card-modern p-6">
                <h3 class="text-xl font-bold text-white mb-6 border-l-4 border-gotham-cyan pl-3">Goal Distribution</h3>
                <div class="h-64 flex items-center justify-center">
                    <canvas id="goalTypeChart"></canvas>
                </div>
            </div>
            <div class="card-modern p-6">
                <h3 class="text-xl font-bold text-white mb-6 border-l-4 border-gotham-cyan pl-3">Performance by Venue
                </h3>
                <div class="h-64 flex items-center justify-center">
                    <canvas id="homeAwayChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Tabbed Stats -->
        <div class="mt-12">
            <!-- Tabs -->
            <div class="flex justify-center mb-8 gap-2">
                <button id="tab-overall" class="btn-primary" onclick="switchTab('overall')">Overall</button>
                <button id="tab-attacking" class="btn-outline" onclick="switchTab('attacking')">Attack</button>
                <button id="tab-defending" class="btn-outline" onclick="switchTab('defending')">Defense</button>
            </div>

            <!-- Content Area -->
            <div class="glass-panel p-8 rounded-2xl min-h-[300px]">
                <div id="tab-content-overall" class="tab-content animate-fade-in">
                    <p class="text-center text-gray-500">Loading...</p>
                </div>
                <div id="tab-content-attacking" class="tab-content hidden animate-fade-in">
                    <p class="text-center text-gray-500">Loading...</p>
                </div>
                <div id="tab-content-defending" class="tab-content hidden animate-fade-in">
                    <p class="text-center text-gray-500">Loading...</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Global for SwitchTab access
        function switchTab(tabName) {
            // Update Buttons
            ['overall', 'attacking', 'defending'].forEach(t => {
                const btn = document.getElementById(`tab-${t}`);
                if (t === tabName) {
                    btn.classList.replace('btn-outline', 'btn-primary');
                } else {
                    btn.classList.replace('btn-primary', 'btn-outline');
                }
            });

            // Update Content
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            const activeContent = document.getElementById(`tab-content-${tabName}`);
            activeContent.classList.remove('hidden');

            // Simple fade reset
            activeContent.classList.remove('animate-fade-in');
            void activeContent.offsetWidth; // trigger reflow
            activeContent.classList.add('animate-fade-in');
        }

        document.addEventListener('DOMContentLoaded', function () {
            const standingsContainer = document.getElementById('standings-container');
            const tabOverall = document.getElementById('tab-content-overall');
            const tabAttacking = document.getElementById('tab-content-attacking');
            const tabDefending = document.getElementById('tab-content-defending');

            // Charts
            const goalChartCtx = document.getElementById('goalTypeChart')?.getContext('2d');
            const homeAwayChartCtx = document.getElementById('homeAwayChart')?.getContext('2d');
            let goalChart, homeAwayChart;

            // HELPERS
            const getStat = (stats, id) => stats?.[id]?.value ?? '-';
            const formatPercent = (stats, id) => typeof stats?.[id]?.value === 'number' ? stats[id].value.toFixed(1) + '%' : '-';

            const buildStatItem = (label, value) => `
                <div class="text-center p-4 border border-gray-800 rounded-lg hover:border-gotham-cyan/50 transition-colors bg-black/40">
                    <p class="text-gray-400 text-xs uppercase tracking-wider mb-1 opacity-70">${label}</p>
                    <p class="text-3xl font-black text-white">${value}</p>
                </div>
            `;

            function renderStandings(standings) {
                if (standings) {
                    standingsContainer.innerHTML = `
                        <div class="relative z-10 flex flex-col md:flex-row justify-around items-center gap-8 text-center">
                            <div>
                                <p class="text-gray-400 uppercase tracking-widest text-sm mb-2">League Rank</p>
                                <p class="text-7xl font-black text-white" style="text-shadow: 0 0 30px rgba(34,211,238,0.3)">${standings.rank}</p>
                            </div>
                            <div class="h-16 w-px bg-gray-800 hidden md:block"></div>
                            <div>
                                <p class="text-gray-400 uppercase tracking-widest text-sm mb-2">Total Points</p>
                                <p class="text-5xl font-bold text-white">${standings.points}</p>
                            </div>
                            <div class="h-16 w-px bg-gray-800 hidden md:block"></div>
                            <div>
                                <p class="text-gray-400 uppercase tracking-widest text-sm mb-2">Record</p>
                                <p class="text-5xl font-bold text-white">${standings.record}</p>
                            </div>
                        </div>
                    `;
                }
            }

            function renderStats(stats) {
                // --- Overall Tab ---
                let overallHtml = '<div class="grid grid-cols-2 md:grid-cols-4 gap-4">';
                overallHtml += buildStatItem('Games Played', getStat(stats, 'played'));
                overallHtml += buildStatItem('Wins', getStat(stats, 'wins'));
                overallHtml += buildStatItem('Goal Diff', getStat(stats, 'goals-difference'));
                overallHtml += buildStatItem('Clean Sheets', getStat(stats, 'Clean Sheets'));
                overallHtml += '</div>';
                tabOverall.innerHTML = overallHtml;

                // --- Attacking Tab ---
                let attackingHtml = '<div class="grid grid-cols-2 md:grid-cols-4 gap-4">';
                attackingHtml += buildStatItem('Goals', getStat(stats, 'goals-scored'));
                attackingHtml += buildStatItem('Assists', getStat(stats, 'Goal Assists'));
                attackingHtml += buildStatItem('Shots', getStat(stats, 'Total Shots'));
                attackingHtml += buildStatItem('Possession', formatPercent(stats, 'Possession Percentage'));
                attackingHtml += '</div>';
                tabAttacking.innerHTML = attackingHtml;

                // --- Defending Tab ---
                let defendingHtml = '<div class="grid grid-cols-2 md:grid-cols-4 gap-4">';
                defendingHtml += buildStatItem('Conceded', getStat(stats, 'goals-conceded'));
                defendingHtml += buildStatItem('Tackles Won', getStat(stats, 'Tackles Won'));
                defendingHtml += buildStatItem('Interceptions', getStat(stats, 'Interceptions'));
                defendingHtml += buildStatItem('Clearances', getStat(stats, 'Total Clearances'));
                defendingHtml += '</div>';
                tabDefending.innerHTML = defendingHtml;


                // --- CHARTS ---
                Chart.defaults.color = '#9ca3af';
                Chart.defaults.font.family = 'Inter';

                // Donut
                if (goalChartCtx) {
                    const d = [getStat(stats, 'Goals from Inside Box'), getStat(stats, 'Goals from Outside Box'), getStat(stats, 'Headed Goals')];
                    // Fallback if data missing
                    if (d.some(x => x === '-')) d.fill(1);

                    new Chart(goalChartCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Inside Box', 'Outside Box', 'Headed'],
                            datasets: [{
                                data: d,
                                backgroundColor: ['#22d3ee', '#ffffff', '#333333'],
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { position: 'right' } }
                        }
                    });
                }

                // Bar
                if (homeAwayChartCtx) {
                    new Chart(homeAwayChartCtx, {
                        type: 'bar',
                        data: {
                            labels: ['W', 'D', 'L'],
                            datasets: [
                                { label: 'Home', data: [getStat(stats, 'home-wins'), getStat(stats, 'home-draws'), getStat(stats, 'home-losses')], backgroundColor: '#22d3ee', borderRadius: 4 },
                                { label: 'Away', data: [getStat(stats, 'away-wins'), getStat(stats, 'away-draws'), getStat(stats, 'away-losses')], backgroundColor: '#ffffff', borderRadius: 4 }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: { grid: { color: '#333' } },
                                x: { grid: { display: false } }
                            }
                        }
                    });
                }
            }

            // Init
            async function load() {
                try {
                    const response = await fetch('./.netlify/functions/get-gotham-data');
                    if (response.ok) {
                        const data = await response.json();
                        renderStandings(data.standings);
                        renderStats(data.stats);
                    } else {
                        throw new Error("Failed");
                    }
                } catch (e) {
                    // Fallback Visuals (Empty or Sample)
                    renderStandings({ rank: 4, points: 55, record: '12-5-4' });
                    renderStats({}); // will show dashes
                }
            }
            load();
        });
    </script>
    <style>
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</body>

</html>
