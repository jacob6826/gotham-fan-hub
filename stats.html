<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gotham FC Team Stats</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Saira+Semi+Condensed:wght@600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="assets/css/custom-styles.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gotham: { black: '#000000', dark: '#0a0a0a', cyan: '#22d3ee' }
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-black text-gray-200 antialiased selection:bg-cyan-400 selection:text-black">

    <!-- Navbar -->
    <nav class="fixed w-full z-50 glass-nav transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <a href="./index.html" class="flex-shrink-0 flex items-center gap-3 group cursor-pointer">
                    <svg class="h-10 w-10 text-white group-hover:text-gotham-cyan transition-colors"
                        viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M50 0L95.11 25V75L50 100L4.89 75V25L50 0Z" fill="currentColor" />
                        <path d="M50 10L86.6 30V70L50 90L13.4 70V30L50 10Z" fill="#000000" />
                        <text x="50" y="62" font-family="Saira Semi Condensed, sans-serif" font-size="30"
                            font-weight="800" fill="currentColor" text-anchor="middle">GFC</text>
                    </svg>
                    <span
                        class="font-heading font-bold text-2xl tracking-wide text-white group-hover:text-gotham-cyan transition-colors">FAN
                        HUB</span>
                </a>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-8">
                        <a href="./index.html" class="nav-link text-sm tracking-widest uppercase">Home</a>
                        <a href="./roster.html" class="nav-link text-sm tracking-widest uppercase">Roster</a>
                        <a href="#" class="nav-link active text-sm tracking-widest uppercase">Stats</a>
                        <a href="https://www.gothamfc.com/tickets" target="_blank" class="btn-primary text-xs ml-4">Get
                            Tickets</a>
                    </div>
                    <div class="-mr-2 flex md:hidden">
                        <button type="button" id="mobile-menu-btn" class="text-gray-400 hover:text-white p-2"
                            aria-controls="mobile-menu" aria-expanded="false">
                            <span class="sr-only">Open main menu</span>
                            <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Mobile Menu -->
            <div class="hidden md:hidden bg-black/95 backdrop-blur-xl border-b border-gray-800 absolute w-full"
                id="mobile-menu">
                <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                    <a href="./index.html"
                        class="text-gray-300 block px-3 py-2 rounded-md text-base font-medium uppercase tracking-widest hover:bg-gray-800 hover:text-gotham-cyan transition-colors">Home</a>
                    <a href="./roster.html"
                        class="text-gray-300 block px-3 py-2 rounded-md text-base font-medium uppercase tracking-widest hover:bg-gray-800 hover:text-gotham-cyan transition-colors">Roster</a>
                    <a href="#"
                        class="text-white block px-3 py-2 rounded-md text-base font-bold uppercase tracking-widest hover:bg-gray-800 hover:text-gotham-cyan transition-colors">Stats</a>
                    <a href="https://www.gothamfc.com/tickets" target="_blank"
                        class="text-black bg-gotham-cyan block px-3 py-2 rounded-md text-base font-bold uppercase tracking-widest hover:bg-cyan-300 transition-colors mt-4 text-center">Get
                        Tickets</a>
                </div>
            </div>
    </nav>

    <!-- Header -->
    <header class="pt-32 pb-12 px-4 text-center">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-4xl md:text-6xl font-black text-white mb-2 uppercase">Season Analytics</h1>
            <p class="text-gray-400 text-lg font-light mb-10">Breaking down the 2025 Championship Campaign</p>

            <!-- Tabs (Moved Here) -->
            <div class="flex justify-center gap-4">
                <button id="tab-overall" class="btn-primary px-8 py-3 text-lg"
                    onclick="switchTab('overall')">Overall</button>
                <button id="tab-attacking" class="btn-outline px-8 py-3 text-lg"
                    onclick="switchTab('attacking')">Attack</button>
                <button id="tab-defending" class="btn-outline px-8 py-3 text-lg"
                    onclick="switchTab('defending')">Defense</button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 pb-20 space-y-8" id="stats-page-container">

        <!-- Tabbed Stats -->
        <div class="mt-8 mb-8">
            <!-- Content Area -->
            <div class="glass-panel p-8 rounded-2xl min-h-[300px]">
                <div id="tab-content-overall" class="tab-content animate-fade-in">
                    <p class="text-center text-gray-500">Loading...</p>
                </div>
                <div id="tab-content-attacking" class="tab-content hidden animate-fade-in">
                    <p class="text-center text-gray-500">Loading...</p>
                </div>
                <div id="tab-content-defending" class="tab-content hidden animate-fade-in">
                    <p class="text-center text-gray-500">Loading...</p>
                </div>
            </div>
        </div>

        <!-- Standings Banner -->
        <div id="standings-container" class="card-modern p-8 relative overflow-hidden">
            <div class="absolute inset-0 bg-gotham-cyan/5"></div>
            <p class="text-center text-gray-400">Loading standings...</p>
        </div>

        <!-- Charts Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="card-modern p-6">
                <h3 id="chart1-title" class="text-xl font-bold text-white mb-6 border-l-4 border-gotham-cyan pl-3">Goal
                    Distribution</h3>
                <div class="h-64 flex items-center justify-center">
                    <canvas id="goalTypeChart"></canvas>
                </div>
            </div>
            <div class="card-modern p-6">
                <h3 id="chart2-title" class="text-xl font-bold text-white mb-6 border-l-4 border-gotham-cyan pl-3">
                    Performance by Venue
                </h3>
                <div class="h-64 flex items-center justify-center">
                    <canvas id="homeAwayChart"></canvas>
                </div>
            </div>
        </div>
    </main>

    <script>
        let currentData = null;
        let activeChart1 = null;
        let activeChart2 = null;

        // --- CHART CONFIGS ---
        const ChartConfigs = {
            overall: {
                chart1: (stats) => ({
                    type: 'doughnut',
                    data: {
                        labels: ['Inside Box', 'Outside Box', 'Headed'],
                        datasets: [{
                            data: [getStat(stats, 'Goals from Inside Box'), getStat(stats, 'Goals from Outside Box'), getStat(stats, 'Headed Goals')],
                            backgroundColor: ['#22d3ee', '#ffffff', '#333333'],
                            borderWidth: 0
                        }]
                    },
                    label: 'Goal Distribution'
                }),
                chart2: (stats) => ({
                    type: 'bar',
                    data: {
                        labels: ['W', 'D', 'L'],
                        datasets: [
                            { label: 'Home', data: [getStat(stats, 'home-wins'), getStat(stats, 'home-draws'), getStat(stats, 'home-losses')], backgroundColor: '#22d3ee', borderRadius: 4 },
                            { label: 'Away', data: [getStat(stats, 'away-wins'), getStat(stats, 'away-draws'), getStat(stats, 'away-losses')], backgroundColor: '#ffffff', borderRadius: 4 }
                        ]
                    },
                    label: 'Performance by Venue'
                })
            },
            attacking: {
                chart1: (stats) => ({
                    type: 'pie',
                    data: {
                        labels: ['On Target', 'Off Target', 'Blocked'],
                        datasets: [{
                            data: [getStat(stats, 'Shots on Target'), getStat(stats, 'Shots off Target'), getStat(stats, 'Blocked Shots')],
                            backgroundColor: ['#22d3ee', '#333333', '#ffffff'],
                            borderWidth: 0
                        }]
                    },
                    label: 'Shot Accuracy'
                }),
                chart2: (stats) => ({
                    type: 'bar',
                    data: {
                        labels: ['Goals', 'Assists'],
                        datasets: [{
                            label: 'Total',
                            data: [getStat(stats, 'goals-scored'), getStat(stats, 'Goal Assists')],
                            backgroundColor: ['#22d3ee', '#ffffff'],
                            borderRadius: 4
                        }]
                    },
                    options: { indexAxis: 'y' },
                    label: 'Goal Contributions'
                })
            },
            defending: {
                chart1: (stats) => ({
                    type: 'doughnut',
                    data: {
                        labels: ['Tackles Won', 'Lost'],
                        datasets: [{
                            data: [getStat(stats, 'Tackles Won'), getStat(stats, 'Tackles Lost')],
                            backgroundColor: ['#22d3ee', '#333333'],
                            borderWidth: 0
                        }]
                    },
                    label: 'Tackle Success Rate'
                }),
                chart2: (stats) => ({
                    type: 'bar',
                    data: {
                        labels: ['Clearances', 'Interceptions', 'Blocks'],
                        datasets: [{
                            label: 'Actions',
                            data: [getStat(stats, 'Total Clearances'), getStat(stats, 'Interceptions'), getStat(stats, 'Blocks')],
                            backgroundColor: '#ffffff',
                            borderRadius: 4
                        }]
                    },
                    label: 'Defensive Actions'
                })
            }
        };

        // --- HELPERS ---
        const getStat = (stats, id) => stats?.[id]?.value ?? 0;
        const getStatDisplay = (stats, id) => stats?.[id]?.value ?? '-';
        const formatPercent = (stats, id) => typeof stats?.[id]?.value === 'number' ? stats[id].value.toFixed(1) + '%' : '-';

        const buildStatItem = (label, value) => `
            <div class="text-center p-4 border border-gray-800 rounded-lg hover:border-gotham-cyan/50 transition-colors bg-black/40">
                <p class="text-gray-400 text-xs uppercase tracking-wider mb-1 opacity-70">${label}</p>
                <p class="text-3xl font-black text-white">${value}</p>
            </div>
        `;

        // Switch Tab Function
        function switchTab(tabName) {
            if (!currentData) return;

            // 1. Update Buttons
            ['overall', 'attacking', 'defending'].forEach(t => {
                const btn = document.getElementById(`tab-${t}`);
                if (t === tabName) {
                    btn.classList.replace('btn-outline', 'btn-primary');
                } else {
                    btn.classList.replace('btn-primary', 'btn-outline');
                }
            });

            // 2. Update Content Visibility
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            const activeContent = document.getElementById(`tab-content-${tabName}`);
            activeContent.classList.remove('hidden');
            activeContent.classList.remove('animate-fade-in');
            void activeContent.offsetWidth;
            activeContent.classList.add('animate-fade-in');

            // 3. Update Banner (Contextual)
            updateBanner(tabName);

            // 4. Update Charts
            updateCharts(tabName);
        }

        function updateBanner(tabName) {
            const container = document.getElementById('standings-container');
            const { standings, stats } = currentData;

            let html = '';

            if (tabName === 'overall') {
                html = `
                    <div class="relative z-10 flex flex-col md:flex-row justify-around items-center gap-8 text-center animate-fade-in">
                        <div>
                            <p class="text-gray-400 uppercase tracking-widest text-sm mb-2">League Rank</p>
                            <p class="text-7xl font-black text-white" style="text-shadow: 0 0 30px rgba(34,211,238,0.3)">${standings?.rank ?? '-'}</p>
                        </div>
                        <div class="h-16 w-px bg-gray-800 hidden md:block"></div>
                        <div>
                            <p class="text-gray-400 uppercase tracking-widest text-sm mb-2">Total Points</p>
                            <p class="text-5xl font-bold text-white">${standings?.points ?? '-'}</p>
                        </div>
                         <div class="h-16 w-px bg-gray-800 hidden md:block"></div>
                        <div>
                            <p class="text-gray-400 uppercase tracking-widest text-sm mb-2">Record</p>
                            <p class="text-5xl font-bold text-white">${standings?.record ?? '-'}</p>
                        </div>
                    </div>
                `;
            } else if (tabName === 'attacking') {
                html = `
                    <div class="relative z-10 flex flex-col md:flex-row justify-around items-center gap-8 text-center animate-fade-in">
                        <div>
                            <p class="text-gray-400 uppercase tracking-widest text-sm mb-2">Goals Scored</p>
                            <p class="text-7xl font-black text-gotham-cyan">${getStatDisplay(stats, 'goals-scored')}</p>
                        </div>
                        <div class="h-16 w-px bg-gray-800 hidden md:block"></div>
                        <div>
                             <p class="text-gray-400 uppercase tracking-widest text-sm mb-2">Goals / Match</p>
                             <p class="text-5xl font-bold text-white">${(getStat(stats, 'goals-scored') / getStat(stats, 'played')).toFixed(2)}</p>
                        </div>
                    </div>
                `;
            } else if (tabName === 'defending') {
                html = `
                    <div class="relative z-10 flex flex-col md:flex-row justify-around items-center gap-8 text-center animate-fade-in">
                        <div>
                            <p class="text-gray-400 uppercase tracking-widest text-sm mb-2">Clean Sheets</p>
                            <p class="text-7xl font-black text-white">${getStatDisplay(stats, 'Clean Sheets')}</p>
                        </div>
                        <div class="h-16 w-px bg-gray-800 hidden md:block"></div>
                        <div>
                             <p class="text-gray-400 uppercase tracking-widest text-sm mb-2">Goals Conceded</p>
                             <p class="text-5xl font-bold text-white">${getStatDisplay(stats, 'goals-conceded')}</p>
                        </div>
                    </div>
                `;
            }
            container.innerHTML = html;
        }

        function updateCharts(tabName) {
            const config = ChartConfigs[tabName];
            const stats = currentData.stats;

            // Destroy old charts
            if (activeChart1) activeChart1.destroy();
            if (activeChart2) activeChart2.destroy();

            // Render Chart 1
            const ctx1 = document.getElementById('goalTypeChart').getContext('2d');
            const conf1 = config.chart1(stats);
            document.getElementById('chart1-title').textContent = conf1.label;

            activeChart1 = new Chart(ctx1, {
                type: conf1.type,
                data: conf1.data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'right', labels: { color: '#9ca3af', font: { family: 'Inter' } } } },
                    ...(conf1.options || {})
                }
            });

            // Render Chart 2
            const ctx2 = document.getElementById('homeAwayChart').getContext('2d');
            const conf2 = config.chart2(stats);
            document.getElementById('chart2-title').textContent = conf2.label;

            activeChart2 = new Chart(ctx2, {
                type: conf2.type,
                data: conf2.data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { grid: { color: '#333' }, ticks: { color: '#9ca3af' } },
                        x: { grid: { display: false }, ticks: { color: '#9ca3af' } }
                    },
                    plugins: { legend: { labels: { color: '#9ca3af' } } },
                    ...(conf2.options || {})
                }
            });
        }

        document.addEventListener('DOMContentLoaded', async function () {
            // Mobile Menu
            const btn = document.getElementById('mobile-menu-btn');
            const menu = document.getElementById('mobile-menu');
            if (btn && menu) {
                btn.addEventListener('click', () => {
                    menu.classList.toggle('hidden');
                });
            }

            Chart.defaults.color = '#9ca3af';
            Chart.defaults.font.family = 'Inter';

            // Load Data
            async function load() {
                try {
                    const response = await fetch('./.netlify/functions/get-gotham-data');
                    if (response.ok) {
                        currentData = await response.json();
                        renderStatsGrids(currentData.stats);
                        switchTab('overall');
                    }
                } catch (e) {
                    console.log('Error loading stats:', e);
                    // Fallback Mock Data
                    currentData = {
                        standings: { rank: 4, points: 41, record: '12-5-4' },
                        stats: {
                            'played': { value: 21 },
                            'wins': { value: 12 },
                            'goals-difference': { value: 12 },
                            'Clean Sheets': { value: 8 },
                            'goals-scored': { value: 35 },
                            'Goal Assists': { value: 24 },
                            'Total Shots': { value: 245 },
                            'Possession Percentage': { value: 52.4 },
                            'goals-conceded': { value: 23 },
                            'Tackles Won': { value: 189 },
                            'Interceptions': { value: 145 },
                            'Total Clearances': { value: 312 },
                            'Goals from Inside Box': { value: 28 },
                            'Goals from Outside Box': { value: 5 },
                            'Headed Goals': { value: 2 },
                            'home-wins': { value: 7 }, 'home-draws': { value: 2 }, 'home-losses': { value: 1 },
                            'away-wins': { value: 5 }, 'away-draws': { value: 3 }, 'away-losses': { value: 3 },
                            'Shots on Target': { value: 110 }, 'Shots off Target': { value: 90 }, 'Blocked Shots': { value: 45 },
                            'Tackles Lost': { value: 65 }, 'Blocks': { value: 89 }
                        }
                    };
                    renderStatsGrids(currentData.stats);
                    switchTab('overall');
                }
            }

            load();
        });

        function renderStatsGrids(stats) {
            const tabOverall = document.getElementById('tab-content-overall');
            const tabAttacking = document.getElementById('tab-content-attacking');
            const tabDefending = document.getElementById('tab-content-defending');

            // Overall
            let overallHtml = '<div class="grid grid-cols-2 md:grid-cols-4 gap-4">';
            overallHtml += buildStatItem('Games Played', getStatDisplay(stats, 'played'));
            overallHtml += buildStatItem('Wins', getStatDisplay(stats, 'wins'));
            overallHtml += buildStatItem('Goal Diff', getStatDisplay(stats, 'goals-difference'));
            overallHtml += buildStatItem('Clean Sheets', getStatDisplay(stats, 'Clean Sheets'));
            overallHtml += '</div>';
            tabOverall.innerHTML = overallHtml;

            // Attacking
            let attackingHtml = '<div class="grid grid-cols-2 md:grid-cols-4 gap-4">';
            attackingHtml += buildStatItem('Goals', getStatDisplay(stats, 'goals-scored'));
            attackingHtml += buildStatItem('Assists', getStatDisplay(stats, 'Goal Assists'));
            attackingHtml += buildStatItem('Shots', getStatDisplay(stats, 'Total Shots'));
            attackingHtml += buildStatItem('Possession', formatPercent(stats, 'Possession Percentage'));
            attackingHtml += '</div>';
            tabAttacking.innerHTML = attackingHtml;

            // Defending
            let defendingHtml = '<div class="grid grid-cols-2 md:grid-cols-4 gap-4">';
            defendingHtml += buildStatItem('Conceded', getStatDisplay(stats, 'goals-conceded'));
            defendingHtml += buildStatItem('Tackles Won', getStatDisplay(stats, 'Tackles Won'));
            defendingHtml += buildStatItem('Interceptions', getStatDisplay(stats, 'Interceptions'));
            defendingHtml += buildStatItem('Clearances', getStatDisplay(stats, 'Total Clearances'));
            defendingHtml += '</div>';
            tabDefending.innerHTML = defendingHtml;
        }
    </script>
    <style>
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</body>

</html>
